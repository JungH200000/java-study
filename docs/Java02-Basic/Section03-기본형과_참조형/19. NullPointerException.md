# NullPointerException

## 1. NullPointerException 이란?

택배를 보낼 때 **주소지 없이** 택배를 발송하면 문제가 생긴다.
자바에서도 이와 비슷하게, **참조값 없이 객체를 찾아가려고 하면** 문제가 발생한다.

이때 발생하는 예외가 **`NullPointerException`** 이다.

* `null` : 값이 존재하지 않음, 가리키는 대상이 없음
* `Pointer` : 어떤 대상을 가리키는 것(참조값)
* `Exception` : 예외

즉, **`null`(아무것도 없는 값)을 가리키려 할 때 발생하는 예외**가 `NullPointerException`이다.
주소가 없는데 그 주소로 찾아가려 해서 생기는 문제라고 이해하면 된다.

객체를 참조할 때는 보통 `.`(dot)을 사용한다.
`참조변수.필드` 처럼 사용하면, **참조값을 이용해 해당 객체를 찾아가서 필드에 접근**한다.

그런데 **참조값이 `null` 이라면**, 즉 **가리키는 객체가 없다면**,
찾아갈 객체(인스턴스)가 없으므로 `.` 으로 접근하는 순간 `NullPointerException` 이 발생한다.

> 정리: **`null` 에 `.`(dot)을 찍었을 때 `NullPointerException` 이 발생한다.**

---

## 2. null 에서 발생하는 예외: `NullMain2`

```java
package ref;

public class NullMain2 {
    public static void main(String[] args) {
        Data data = null;
        data.value = 10; // NullPointerException 예외 발생
        System.out.println("data = " + data.value);
    }
}
```

여기서 `data` 참조형 변수에는 `null` 값이 들어 있다.
그런데 `data.value = 10` 이라고 하면 어떻게 될까?

```java
data.value = 10
null.value = 10 // data에는 null 값이 들어있다.
```

결과적으로 `null` 값은 **참조할 주소가 존재하지 않는다**는 뜻이다.
따라서 **참조할 객체 인스턴스가 존재하지 않으므로**
다음과 같이 `java.lang.NullPointerException` 이 발생하고, 프로그램이 종료된다.

참고로, **예외가 발생하면 그 다음 로직은 실행되지 않는다.**

### 실행 결과

```text
Exception in thread "main" java.lang.NullPointerException: Cannot assign field "value" because "data" is null
    at ref.NullMain2.main(NullMain2.java:6)
```

---

## 3. 멤버 변수와 null

앞선 예제처럼 **지역 변수**가 `null` 인 경우에는 문제를 찾기 비교적 쉽다.
하지만 **멤버 변수(필드)** 가 `null` 인 경우에는 조금 더 주의가 필요하다.

### 3.1 Data 클래스

```java
package ref;

public class Data {
    int value;
}
```

기존에 사용하던 `Data` 클래스를 그대로 사용한다.

---

### 3.2 BigData 클래스

```java
package ref;

public class BigData {
    Data data;
    int count;
}
```

`BigData` 클래스는 다음 두 멤버 변수를 가진다.

* `Data data`  : 참조형 멤버 변수
* `int count`  : 기본형 멤버 변수

---

### 3.3 멤버 변수가 null 인 경우: `NullMain3`

```java
package ref;

public class NullMain3 {
    public static void main(String[] args) {
        BigData bigData = new BigData();

        System.out.println("bigData.count=" + bigData.count);
        System.out.println("bigData.data=" + bigData.data);

        // NullPointerException
        System.out.println("bigData.data.value=" + bigData.data.value);
    }
}
```

### 실행 결과

```text
bigData.count=0
bigData.data=null
Exception in thread "main" java.lang.NullPointerException: Cannot read field "value" because "bigData.data" is null
    at ref.NullMain3.main(NullMain3.java:10)
```

### 동작 설명

<img src="./images/19/001Null_pointer_exception.png" width=400px>

* `BigData` 를 생성하면 **`BigData` 인스턴스가 생성**된다.
* 이때 인스턴스의 **멤버 변수들이 초기화**된다.

    * `BigData` 의 `data` 멤버 변수는 **참조형**이므로 **`null`** 로 초기화된다.
    * `count` 멤버 변수는 **숫자**이므로 **`0`** 으로 초기화된다.
* `bigData.count` 를 출력하면 `0` 이 출력된다.
* `bigData.data` 를 출력하면 참조값인 `null` 이 출력된다.
  이 변수는 **아직 아무것도 참조하지 않는다.**
* `bigData.data.value` 를 출력하려고 하면,

    * `data` 의 값이 `null` 이므로
    * 결국 `null` 에 `.`(dot)을 찍게 되고
    * 참조할 곳이 없으므로 `NullPointerException` 예외가 발생한다.

#### 예외 발생 과정

```java
bigData.data.value
x001.data.value   // bigData는 x001 참조값을 가진다.
null.value        // x001.data는 null 값을 가진다.
NullPointerException // null 값에 .(dot)을 찍으면 예외가 발생한다.
```

---

## 4. 해결 방법: 참조할 객체를 생성하기

위 문제를 해결하려면 **`Data` 인스턴스를 생성하고**,
그 참조값을 `BigData.data` 멤버 변수에 할당하면 된다.

### 4.1 `NullMain4` 예제

```java
package ref;

public class NullMain4 {
    public static void main(String[] args) {
        BigData bigData = new BigData();
        bigData.data = new Data();

        System.out.println("bigData.count=" + bigData.count);
        System.out.println("bigData.data=" + bigData.data);
        System.out.println("bigData.data.value=" + bigData.data.value);
    }
}
```

### 실행 결과

```text
bigData.count=0
bigData.data=ref.Data@x002
bigData.data.value=0
```

### 실행 과정

<img src="./images/19/002Null_pointer_exception.png" width=600px>

```java
bigData.data.value
x001.data.value   // bigData는 x001 참조값을 가진다.
x002.value        // x001.data는 x002 값을 가진다.
0                 // 최종 결과
```

* `bigData` 는 `x001` 이라는 `BigData` 인스턴스를 가리킨다.
* `bigData.data` 에 `new Data()` 로 생성한 인스턴스의 참조값 `x002` 를 넣었다.
* 따라서 `bigData.data.value` 는 결국 `x002.value` 를 의미하고,
  `Data` 의 `value` 기본값인 `0` 이 출력된다.

---

## 정리

`NullPointerException` 이 발생하면,
**“`null` 값에 `.`(dot)을 찍었다”** 라고 생각하면 문제를 쉽게 찾을 수 있다.
